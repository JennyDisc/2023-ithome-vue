import{F as u}from"./FrontNavbar-328d7f87.js";import{_,a as i,m as b,r as f,o as l,c as r,d as C,b as s,g,j as v,F as y,h as x,t as n}from"./index-c8342854.js";import{u as L}from"./LoginStore-6196d13e.js";const R={data(){return{userResList:[],selectCardList:{cardBrandName:"",cardType:"",cardAddress:"",cardComment:""},commentDisabled:!0,apiUserResUrl:"",apiUserResIdUrl:""}},components:{FrontNavbar:u},methods:{userPocket(){i.get(this.apiUserResUrl).then(e=>{this.userResList=e.data[0].userRestaurants}).catch(e=>{console.log(e)})},selectCard(e){this.commentDisabled=!1,this.selectCardList.cardBrandName=e.brandName,this.selectCardList.cardType=e.type,this.selectCardList.cardAddress=e.address,e.comment?this.selectCardList.cardComment=e.comment:this.selectCardList.cardComment=""},resetTable(){this.selectCardList.cardBrandName="",this.selectCardList.cardType="",this.selectCardList.cardAddress="",this.selectCardList.cardComment="",this.commentDisabled=!0},submitComment(){event.preventDefault(),this.selectCardList.cardComment!==""?i.get(this.apiUserResUrl).then(e=>{const a=e.data[0],m=a.userRestaurants.findIndex(o=>o.brandName===this.selectCardList.cardBrandName);a.userRestaurants[m].comment=this.selectCardList.cardComment,i.put(this.apiUserResIdUrl,a).then(o=>{console.log(o),alert("該餐廳評論已更新"),this.userPocket()}).catch(o=>{console.log(o),alert("餐廳評論更新失敗")})}).catch(e=>{console.log(e),alert("無法更新到會員口袋餐廳裡，請洽網站管理員!")}).finally(()=>{this.resetTable()}):alert("餐廳評欄位不可空值!")},delComment(){event.preventDefault(),this.selectCardList.cardComment!==""?i.get(this.apiUserResUrl).then(e=>{console.log(e);const a=e.data[0],m=a.userRestaurants.findIndex(o=>o.brandName===this.selectCardList.cardBrandName);a.userRestaurants[m].comment="",i.put(this.apiUserResIdUrl,a).then(o=>{console.log(o),alert("該餐廳評論已移除"),this.resetTable(),this.userPocket()}).catch(o=>{console.log(o),alert("移除該餐廳評論失敗")})}).catch(e=>{console.log(e),alert("無法更新到會員口袋餐廳裡，請洽網站管理員!")}):alert("餐廳評欄位已是空值，無法移除評論!")}},created(){this.apiUserResUrl=`http://localhost:3002/userRes?email=${this.userEmail}`,this.apiUserResIdUrl=`http://localhost:3002/userRes/${this.userId}`},mounted(){this.userPocket()},computed:{...b(L,{userName:e=>e.name,userEmail:e=>e.email,userId:e=>e.id})}},U={class:"container"},k=s("div",{class:"row mb-4"},[s("div",{class:"col"},[s("h1",null,"餐廳實評")])],-1),w={class:"row mb-4"},N=s("div",{class:"col-4 d-none d-lg-block"},[s("img",{src:"https://plus.unsplash.com/premium_photo-1671493286864-f354f3d2feb5?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1974&q=80",alt:"關於喜愛的圖",class:"img-fluid"})],-1),D=s("div",{class:"col-lg"},null,-1),B={class:"col col-lg-4"},I={class:"row g-2 mb-4"},T=s("label",{for:"type",class:"col-sm-3 col-form-label"},"品牌受眾",-1),E=["placeholder"],F={class:"row g-2 mb-4"},A=s("label",{for:"res-name",class:"col-sm-3 col-form-label"},"品牌名稱",-1),V=["placeholder"],M={class:"row g-2 mb-4"},P=s("label",{for:"address",class:"col-sm-3 col-form-label"},"地址",-1),j=["placeholder"],H={class:"row g-2 mb-4"},S=s("label",{for:"exampleFormControlTextarea1",class:"col-sm-3 col-form-label"},"餐廳評論",-1),G=["disabled"],q={class:"d-flex justify-content-end mb-4"},W={class:"row d-flex flex-wrap"},Y=["onClick"],z={class:"card"},J={key:0,class:"card-header comment-color"},K={key:1,class:"card-header"},O={class:"card-body"},Q={class:"card-title"},X={class:"card-text"},Z=["data-bs-target","aria-controls"],$=["data-bs-target","aria-controls"],ss=["id"],es={class:"card card-body"},ts=["id"],as={class:"card card-body"};function os(e,a,m,o,c,h){const p=f("FrontNavbar");return l(),r("div",U,[C(p),s("section",null,[k,s("div",w,[N,D,s("div",B,[s("form",null,[s("div",I,[T,s("input",{type:"text",id:"type",class:"form-control col-sm",placeholder:c.selectCardList.cardType,disabled:""},null,8,E)]),s("div",F,[A,s("input",{type:"text",id:"res-name",class:"form-control col-sm",placeholder:c.selectCardList.cardBrandName,disabled:""},null,8,V)]),s("div",M,[P,s("input",{type:"text",id:"address",class:"form-control col-sm",placeholder:c.selectCardList.cardAddress,disabled:""},null,8,j)]),s("div",H,[S,g(s("textarea",{class:"form-control col-sm",id:"exampleFormControlTextarea1",rows:"6",disabled:c.commentDisabled,"onUpdate:modelValue":a[0]||(a[0]=t=>c.selectCardList.cardComment=t)},null,8,G),[[v,c.selectCardList.cardComment]])]),s("div",q,[s("button",{class:"btn btn-lg btn-danger me-4",type:"submit",onClick:a[1]||(a[1]=t=>h.delComment())}," 移除評論 "),s("button",{class:"btn btn-lg btn-primary",type:"submit",onClick:a[2]||(a[2]=t=>h.submitComment())}," 提交評論 ")])])])])]),s("section",W,[(l(!0),r(y,null,x(c.userResList,(t,d)=>(l(),r("div",{class:"col-lg-3 mb-4",key:t},[s("a",{class:"comment-card",onClick:ls=>h.selectCard(t)},[s("div",z,[t.comment?(l(),r("h2",J,n(t.type),1)):(l(),r("h2",K,n(t.type),1)),s("div",O,[s("h3",Q,n(t.brandName),1),s("p",X,n(t.address),1),s("p",null,[t.comment?(l(),r("button",{key:0,class:"btn btn-warning",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseExample"+d,"aria-expanded":"true","aria-controls":"collapseExample"+d}," 查看實評 ",8,Z)):(l(),r("button",{key:1,class:"btn btn-warning",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseExample"+d,"aria-expanded":"false","aria-controls":"collapseExample"+d}," 查看實評 ",8,$))]),t.comment?(l(),r("div",{key:0,class:"collapse show",id:"collapseExample"+d},[s("div",es,n(t.comment),1)],8,ss)):(l(),r("div",{key:1,class:"collapse",id:"collapseExample"+d},[s("div",as,n(t.comment),1)],8,ts))])])],8,Y)]))),128))])])}const ns=_(R,[["render",os]]);export{ns as default};
