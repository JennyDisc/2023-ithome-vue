import{F as b}from"./FrontNavbar-193692e6.js";import{_ as g,a as d,m as v,r as y,o,c as n,d as _,b as s,g as u,v as f,F as p,h as m,i as N,t as h}from"./index-48e79dc0.js";import{u as U}from"./LoginStore-98680ae9.js";const T={data(){return{restaurants:[],userResList:[],filterRes:{filterBrandName:[],filterType:[],filterAddress:"",filterMapUrl:""},tempRes:{selectBrandName:"",selectType:""},saveRes:{saveBrandName:"",saveType:"",saveAddress:"",saveMapUrl:""},brandListDisabled:!0,isSorting:!1,ascending:!0,apiUserResUrl:"",apiUserResIdUrl:""}},components:{FrontNavbar:b},methods:{pocket(){d.get("http://localhost:3001/restaurants").then(e=>{this.restaurants=e.data,console.log(this.uniqueTypes)}).catch(e=>{console.log(e)})},userPocket(){d.get(this.apiUserResUrl).then(e=>{console.log(e),this.userResList=e.data[0].userRestaurants,console.log(this.userResList)}).catch(e=>{console.log(e)})},selectTypeChange(){this.brandListDisabled=!1,this.filterRes.filterType=this.tempRes.selectType,this.saveRes.saveType=this.tempRes.selectType,this.tempRes.selectType!=="全部受眾"?(this.filterRes.filterBrandName=this.restaurants.filter(e=>e.type===this.tempRes.selectType).map(e=>e.brandName),console.log(this.filterRes.filterBrandName)):(this.filterRes.filterBrandName=this.restaurants.map(e=>e.brandName),console.log(this.filterRes.filterBrandName),console.log(this.filterRes.filterType)),this.tempRes.selectBrandName="",this.filterRes.filterAddress=""},resetTable(){this.tempRes.selectType="",this.tempRes.selectBrandName="",this.filterRes.filterAddress="",this.filterRes.filterMapUrl=""},selectNameChange(){this.saveRes.saveBrandName=this.tempRes.selectBrandName,this.filterRes.filterAddress=this.restaurants.filter(e=>e.brandName===this.tempRes.selectBrandName).map(e=>e.address),console.log(this.filterRes.filterAddress),this.filterRes.filterMapUrl=this.restaurants.filter(e=>e.brandName===this.tempRes.selectBrandName).map(e=>e.mapUrl),console.log(this.filterRes.filterMapUrl),this.saveRes.saveAddress=this.filterRes.filterAddress[0],this.saveRes.saveMapUrl=this.filterRes.filterMapUrl[0],this.filterRes.filterType==="全部受眾"&&(this.filterRes.filterType=this.restaurants.filter(e=>e.brandName===this.tempRes.selectBrandName).map(e=>e.type),console.log(this.filterRes.filterType),this.saveRes.saveType=this.filterRes.filterType[0])},submitPucket(){event.preventDefault(),this.saveRes.saveBrandName!==""&this.saveRes.saveAddress!==""&this.saveRes.saveType!==""?d.get(this.apiUserResUrl).then(e=>{console.log(e);const l=e.data[0];console.log(l);const a={brandName:this.saveRes.saveBrandName,address:this.saveRes.saveAddress,type:this.saveRes.saveType,mapUrl:this.saveRes.saveMapUrl},c=l.userRestaurants.some(r=>r.brandName===a.brandName);console.log(c),c?alert("該餐廳已存在!"):(l.userRestaurants.push(a),alert("口袋添加成功"),d.put(this.apiUserResIdUrl,l),this.userPocket())}).catch(e=>{console.log(e),alert("口袋添加失敗")}):alert("欄位不可空值!"),this.resetTable()},toggleSorting(){this.ascending?(this.ascending=!this.ascending,this.isSorting=!0):this.ascending=!0},delPucket(e){d.get(this.apiUserResUrl).then(l=>{console.log(l);const a=l.data[0],c=a.userRestaurants.findIndex(r=>r.brandName===e.brandName);console.log(c),a.userRestaurants.splice(c,1),console.log(a),d.put(this.apiUserResIdUrl,a).then(r=>{console.log(r),alert("成功移除該筆餐廳"),this.userPocket()}).catch(r=>{console.log(r),alert("該筆餐廳移除失敗，請洽網站管理員!")}).finally(()=>{this.resetTable()})})}},created(){this.apiUserResUrl=`http://localhost:3002/userRes?email=${this.userEmail}`,this.apiUserResIdUrl=`http://localhost:3002/userRes/${this.userId}`},mounted(){this.pocket(),this.userPocket()},computed:{uniqueTypes(){return Array.from(new Set(this.restaurants.map(e=>e.type)))},...v(U,{userName:e=>e.name,userEmail:e=>e.email,userId:e=>e.id}),orderByList(){const e=[...this.userResList];return e.sort((l,a)=>this.ascending?l.type.localeCompare(a.type):a.type.localeCompare(l.type)),e}}},B={class:"container"},k={class:"row mb-4"},w=s("div",{class:"col-lg"},null,-1),x=s("div",{class:"col-4 d-none d-lg-block"},[s("img",{src:"https://images.unsplash.com/photo-1603481502506-275d81ffcdef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1935&q=80",alt:"關於喜愛的圖",class:"img-fluid"})],-1),C=s("div",{class:"col-lg"},null,-1),A={class:"col col-lg-4"},M=s("h1",{class:"mb-4 text-center"},"新增口袋餐廳",-1),L={class:"row g-2 mb-3"},D=s("label",{for:"type",class:"col-sm-3 col-form-label"},"品牌受眾",-1),S=s("option",{value:"",disabled:"",selected:""},"請選擇品牌受眾",-1),P=s("option",{value:"全部受眾"},"全部受眾",-1),I=["value"],V={class:"row g-2 mb-3"},F=s("label",{for:"res-name",class:"col-sm-3 col-form-label"},"品牌名稱",-1),q=["disabled"],j=s("option",{value:"",disabled:"",selected:""},"請選擇品牌名稱",-1),E=["value"],H={class:"row g-2 mb-3"},G=s("label",{for:"address",class:"col-sm-3 col-form-label"},"地址",-1),z=["placeholder"],W={key:0,class:"mb-4"},Y=["src"],J={class:"d-flex justify-content-end"},K=s("div",{class:"col-lg"},null,-1),O={class:"mb-4"},Q={class:"d-flex justify-content-end mb-4"},X={class:"table table-bordered table-hover"},Z=s("thead",null,[s("tr",null,[s("th",{scope:"col",class:"table-secondary"},"品牌受眾"),s("th",{scope:"col",class:"table-secondary"},"品牌名稱"),s("th",{scope:"col",class:"table-secondary"},"地址"),s("th",{scope:"col",class:"table-warning"},"動作")])],-1),$={class:"table-warning"},ee=["onClick"];function se(e,l,a,c,r,i){const R=y("FrontNavbar");return o(),n("div",B,[_(R),s("section",k,[w,x,C,s("div",A,[s("form",null,[M,s("div",L,[D,u(s("select",{name:"品牌受眾",id:"type",class:"form-select col-sm",onChange:l[0]||(l[0]=(...t)=>i.selectTypeChange&&i.selectTypeChange(...t)),"onUpdate:modelValue":l[1]||(l[1]=t=>r.tempRes.selectType=t)},[S,P,(o(!0),n(p,null,m(i.uniqueTypes,t=>(o(),n("option",{value:t,key:t},h(t),9,I))),128))],544),[[f,r.tempRes.selectType]])]),s("div",V,[F,u(s("select",{name:"品牌名稱",id:"res-name",class:"form-select col-sm",disabled:r.brandListDisabled,onChange:l[2]||(l[2]=(...t)=>i.selectNameChange&&i.selectNameChange(...t)),"onUpdate:modelValue":l[3]||(l[3]=t=>r.tempRes.selectBrandName=t)},[j,(o(!0),n(p,null,m(r.filterRes.filterBrandName,t=>(o(),n("option",{value:t,key:t},h(t),9,E))),128))],40,q),[[f,r.tempRes.selectBrandName]])]),s("div",H,[G,s("input",{class:"form-control col-sm",type:"text",disabled:"",id:"address",placeholder:r.filterRes.filterAddress},null,8,z)]),r.filterRes.filterMapUrl!==""?(o(),n("div",W,[s("iframe",{src:r.filterRes.filterMapUrl,width:"100%",height:"350",style:{border:"0"},allowfullscreen:"",loading:"lazy",referrerpolicy:"no-referrer-when-downgrade"},null,8,Y)])):N("",!0),s("div",J,[s("button",{class:"btn btn-lg btn-primary mb-4",type:"submit",onClick:l[4]||(l[4]=t=>i.submitPucket())}," 加入口袋 ")])])]),K]),s("section",O,[s("div",Q,[s("button",{type:"button",class:"btn btn-warning",onClick:l[5]||(l[5]=(...t)=>i.toggleSorting&&i.toggleSorting(...t))}," 依品牌受眾排序 ")]),s("table",X,[Z,s("tbody",null,[(o(!0),n(p,null,m(r.isSorting?i.orderByList:r.userResList,t=>(o(),n("tr",{key:t},[s("td",null,h(t.type),1),s("td",null,h(t.brandName),1),s("td",null,h(t.address),1),s("td",$,[s("button",{type:"button",class:"btn btn-secondary",onClick:te=>i.delPucket(t)}," 移除 ",8,ee)])]))),128))])])])])}const ie=g(T,[["render",se]]);export{ie as default};
