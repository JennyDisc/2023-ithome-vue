import{F as R}from"./FrontNavbar-328d7f87.js";import{_ as v,a as d,m as g,r as _,o as n,c as o,d as y,b as s,g as u,v as f,F as m,h as p,i as N,t as c}from"./index-c8342854.js";import{u as U}from"./LoginStore-6196d13e.js";const T={data(){return{restaurants:[],userResList:[],filterRes:{filterBrandName:[],filterType:[],filterAddress:"",filterMapUrl:""},tempRes:{selectBrandName:"",selectType:""},saveRes:{saveBrandName:"",saveType:"",saveAddress:"",saveMapUrl:""},brandListDisabled:!0,isSorting:!1,ascending:!0,apiUserResUrl:"",apiUserResIdUrl:""}},components:{FrontNavbar:R},methods:{pocket(){d.get("http://localhost:3001/restaurants").then(e=>{this.restaurants=e.data}).catch(e=>{console.log(e)})},userPocket(){d.get(this.apiUserResUrl).then(e=>{console.log(e),this.userResList=e.data[0].userRestaurants}).catch(e=>{console.log(e)})},selectTypeChange(){this.brandListDisabled=!1,this.filterRes.filterType=this.tempRes.selectType,this.saveRes.saveType=this.tempRes.selectType,this.tempRes.selectType!=="全部受眾"?this.filterRes.filterBrandName=this.restaurants.filter(e=>e.type===this.tempRes.selectType).map(e=>e.brandName):this.filterRes.filterBrandName=this.restaurants.map(e=>e.brandName),this.tempRes.selectBrandName="",this.filterRes.filterAddress=""},resetTable(){this.tempRes.selectType="",this.tempRes.selectBrandName="",this.filterRes.filterAddress="",this.filterRes.filterMapUrl=""},selectNameChange(){this.saveRes.saveBrandName=this.tempRes.selectBrandName,this.filterRes.filterAddress=this.restaurants.filter(e=>e.brandName===this.tempRes.selectBrandName).map(e=>e.address),this.filterRes.filterMapUrl=this.restaurants.filter(e=>e.brandName===this.tempRes.selectBrandName).map(e=>e.mapUrl),this.saveRes.saveAddress=this.filterRes.filterAddress[0],this.saveRes.saveMapUrl=this.filterRes.filterMapUrl[0],this.filterRes.filterType==="全部受眾"&&(this.filterRes.filterType=this.restaurants.filter(e=>e.brandName===this.tempRes.selectBrandName).map(e=>e.type),this.saveRes.saveType=this.filterRes.filterType[0])},submitPucket(){event.preventDefault(),this.saveRes.saveBrandName!==""&this.saveRes.saveAddress!==""&this.saveRes.saveType!==""?d.get(this.apiUserResUrl).then(e=>{console.log(e);const a=e.data[0],r={brandName:this.saveRes.saveBrandName,address:this.saveRes.saveAddress,type:this.saveRes.saveType,mapUrl:this.saveRes.saveMapUrl};a.userRestaurants.some(l=>l.brandName===r.brandName)?alert("該餐廳已存在!"):(a.userRestaurants.push(r),alert("口袋添加成功"),d.put(this.apiUserResIdUrl,a),this.userPocket())}).catch(e=>{console.log(e),alert("口袋添加失敗")}):alert("欄位不可空值!"),this.resetTable()},toggleSorting(){this.ascending?(this.ascending=!this.ascending,this.isSorting=!0):this.ascending=!0},delPucket(e){d.get(this.apiUserResUrl).then(a=>{const r=a.data[0],h=r.userRestaurants.findIndex(l=>l.brandName===e.brandName);r.userRestaurants.splice(h,1),d.put(this.apiUserResIdUrl,r).then(l=>{console.log(l),alert("成功移除該筆餐廳"),this.userPocket()}).catch(l=>{console.log(l),alert("該筆餐廳移除失敗，請洽網站管理員!")}).finally(()=>{this.resetTable()})})}},created(){this.apiUserResUrl=`http://localhost:3002/userRes?email=${this.userEmail}`,this.apiUserResIdUrl=`http://localhost:3002/userRes/${this.userId}`},mounted(){this.pocket(),this.userPocket()},computed:{uniqueTypes(){return Array.from(new Set(this.restaurants.map(e=>e.type)))},...g(U,{userName:e=>e.name,userEmail:e=>e.email,userId:e=>e.id}),orderByList(){const e=[...this.userResList];return e.sort((a,r)=>this.ascending?a.type.localeCompare(r.type):r.type.localeCompare(a.type)),e}}},B={class:"container"},k={class:"row mb-4"},w=s("div",{class:"col-lg"},null,-1),x=s("div",{class:"col-4 d-none d-lg-block"},[s("img",{src:"https://images.unsplash.com/photo-1603481502506-275d81ffcdef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1935&q=80",alt:"關於喜愛的圖",class:"img-fluid"})],-1),C=s("div",{class:"col-lg"},null,-1),A={class:"col col-lg-4"},M=s("h1",{class:"mb-4 text-center"},"新增口袋餐廳",-1),D={class:"row g-2 mb-3"},L=s("label",{for:"type",class:"col-sm-3 col-form-label"},"品牌受眾",-1),S=s("option",{value:"",disabled:"",selected:""},"請選擇品牌受眾",-1),P=s("option",{value:"全部受眾"},"全部受眾",-1),I=["value"],V={class:"row g-2 mb-3"},F=s("label",{for:"res-name",class:"col-sm-3 col-form-label"},"品牌名稱",-1),j=["disabled"],q=s("option",{value:"",disabled:"",selected:""},"請選擇品牌名稱",-1),E=["value"],H={class:"row g-2 mb-3"},G=s("label",{for:"address",class:"col-sm-3 col-form-label"},"地址",-1),z=["placeholder"],W={key:0,class:"mb-4"},Y=["src"],J={class:"d-flex justify-content-end"},K=s("div",{class:"col-lg"},null,-1),O={class:"mb-4"},Q={class:"d-flex justify-content-end mb-4"},X={class:"table table-bordered table-hover"},Z=s("thead",null,[s("tr",null,[s("th",{scope:"col",class:"table-secondary"},"品牌受眾"),s("th",{scope:"col",class:"table-secondary"},"品牌名稱"),s("th",{scope:"col",class:"table-secondary"},"地址"),s("th",{scope:"col",class:"table-warning"},"動作")])],-1),$={class:"table-warning"},ee=["onClick"];function se(e,a,r,h,l,i){const b=_("FrontNavbar");return n(),o("div",B,[y(b),s("section",k,[w,x,C,s("div",A,[s("form",null,[M,s("div",D,[L,u(s("select",{name:"品牌受眾",id:"type",class:"form-select col-sm",onChange:a[0]||(a[0]=(...t)=>i.selectTypeChange&&i.selectTypeChange(...t)),"onUpdate:modelValue":a[1]||(a[1]=t=>l.tempRes.selectType=t)},[S,P,(n(!0),o(m,null,p(i.uniqueTypes,t=>(n(),o("option",{value:t,key:t},c(t),9,I))),128))],544),[[f,l.tempRes.selectType]])]),s("div",V,[F,u(s("select",{name:"品牌名稱",id:"res-name",class:"form-select col-sm",disabled:l.brandListDisabled,onChange:a[2]||(a[2]=(...t)=>i.selectNameChange&&i.selectNameChange(...t)),"onUpdate:modelValue":a[3]||(a[3]=t=>l.tempRes.selectBrandName=t)},[q,(n(!0),o(m,null,p(l.filterRes.filterBrandName,t=>(n(),o("option",{value:t,key:t},c(t),9,E))),128))],40,j),[[f,l.tempRes.selectBrandName]])]),s("div",H,[G,s("input",{class:"form-control col-sm",type:"text",disabled:"",id:"address",placeholder:l.filterRes.filterAddress},null,8,z)]),l.filterRes.filterMapUrl!==""?(n(),o("div",W,[s("iframe",{src:l.filterRes.filterMapUrl,width:"100%",height:"350",style:{border:"0"},allowfullscreen:"",loading:"lazy",referrerpolicy:"no-referrer-when-downgrade"},null,8,Y)])):N("",!0),s("div",J,[s("button",{class:"btn btn-lg btn-primary mb-4",type:"submit",onClick:a[4]||(a[4]=t=>i.submitPucket())}," 加入口袋 ")])])]),K]),s("section",O,[s("div",Q,[s("button",{type:"button",class:"btn btn-warning",onClick:a[5]||(a[5]=(...t)=>i.toggleSorting&&i.toggleSorting(...t))}," 依品牌受眾排序 ")]),s("table",X,[Z,s("tbody",null,[(n(!0),o(m,null,p(l.isSorting?i.orderByList:l.userResList,t=>(n(),o("tr",{key:t},[s("td",null,c(t.type),1),s("td",null,c(t.brandName),1),s("td",null,c(t.address),1),s("td",$,[s("button",{type:"button",class:"btn btn-secondary",onClick:te=>i.delPucket(t)}," 移除 ",8,ee)])]))),128))])])])])}const ie=v(T,[["render",se]]);export{ie as default};
